
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudGallery - Hospedagem de Imagens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .image-card:hover .overlay { opacity: 1; }
    </style>
</head>
<body class="min-h-screen pb-12">

    <nav class="glass sticky top-0 z-50 border-b border-gray-200 py-4 mb-8">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-blue-600 flex items-center gap-2">
                <i class="fas fa-cloud-upload-alt"></i> CloudGallery
            </h1>
            <div class="flex gap-2">
                <button onclick="exportBackup()" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg font-semibold transition-colors flex items-center gap-1">
                    <i class="fas fa-download"></i> Exportar
                </button>
                <button onclick="document.getElementById('importInput').click()" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg font-semibold transition-colors flex items-center gap-1">
                    <i class="fas fa-upload"></i> Importar
                </button>
                <input type="file" id="importInput" class="hidden" accept=".json" onchange="importBackup(event)">
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 max-w-5xl">
        
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 mb-10 text-center">
            <h2 class="text-xl font-semibold mb-4">Fazer novo upload</h2>
            <div class="flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-xl p-10 hover:border-blue-400 transition-colors cursor-pointer" id="dropzone">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                <div class="bg-blue-50 p-4 rounded-full mb-4">
                    <i class="fas fa-images text-3xl text-blue-500"></i>
                </div>
                <p class="text-gray-600">Arraste uma imagem ou <span class="text-blue-600 font-bold">clique aqui</span></p>
                <p class="text-xs text-gray-400 mt-2">Formatos suportados: JPG, PNG, GIF, BMP</p>
            </div>
            
            <div id="loading" class="hidden mt-4">
                <div class="flex items-center justify-center gap-3 text-blue-600">
                    <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                    <span>Enviando para o servidor...</span>
                </div>
            </div>
        </div>

        <h3 class="text-lg font-bold text-gray-700 mb-6 flex items-center gap-2">
            <i class="fas fa-th-large"></i> Minha Galeria
        </h3>
        
        <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>

        <div id="emptyState" class="hidden text-center py-20">
            <i class="far fa-folder-open text-5xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">Nenhuma imagem hospedada ainda.</p>
        </div>

    </main>

    <script>
        const API_KEY = 'b2f2d2c7f96736dadf9fd17f82c72fb3';
        const fileInput = document.getElementById('fileInput');
        const dropzone = document.getElementById('dropzone');
        const gallery = document.getElementById('gallery');
        const loading = document.getElementById('loading');
        const emptyState = document.getElementById('emptyState');

        // Carregar imagens salvas ao iniciar
        let savedImages = JSON.parse(localStorage.getItem('my_hosted_images')) || [];

        function init() {
            renderGallery();
        }

        // Lógica de Backup
        function exportBackup() {
            if (savedImages.length === 0) return alert('Não há dados para exportar.');
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(savedImages));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "backup_galeria.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        savedImages = importedData;
                        localStorage.setItem('my_hosted_images', JSON.stringify(savedImages));
                        renderGallery();
                        alert('Backup importado com sucesso!');
                    }
                } catch (err) {
                    alert('Erro ao ler o arquivo de backup.');
                }
            };
            reader.readAsText(file);
        }

        // Lógica de Upload
        dropzone.onclick = () => fileInput.click();

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) uploadImage(file);
        };

        async function uploadImage(file) {
            loading.classList.remove('hidden');
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    const imageData = {
                        id: Date.now(),
                        url: result.data.url,
                        thumb: result.data.display_url,
                        delete_url: result.data.delete_url,
                        name: file.name
                    };
                    saveImage(imageData);
                } else {
                    alert('Erro ao subir imagem.');
                }
            } catch (error) {
                console.error(error);
                alert('Erro na conexão com ImgBB.');
            } finally {
                loading.classList.add('hidden');
                fileInput.value = '';
            }
        }

        function saveImage(img) {
            savedImages.unshift(img);
            localStorage.setItem('my_hosted_images', JSON.stringify(savedImages));
            renderGallery();
        }

        function deleteImage(id) {
            if(confirm('Deseja remover esta imagem da sua galeria local? (Isso não a deleta do servidor ImgBB)')) {
                savedImages = savedImages.filter(img => img.id !== id);
                localStorage.setItem('my_hosted_images', JSON.stringify(savedImages));
                renderGallery();
            }
        }

        function copyToClipboard(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copiada com sucesso!');
            });
        }

        function renderGallery() {
            if (savedImages.length === 0) {
                emptyState.classList.remove('hidden');
                gallery.innerHTML = '';
                return;
            }
            emptyState.classList.add('hidden');

            gallery.innerHTML = savedImages.map(img => `
                <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-gray-200 group relative image-card">
                    <div class="aspect-video overflow-hidden bg-gray-100">
                        <img src="${img.thumb}" alt="${img.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    </div>
                    <div class="p-4">
                        <p class="text-sm font-medium text-gray-700 truncate mb-3">${img.name}</p>
                        <div class="flex items-center gap-2">
                            <button onclick="copyToClipboard('${img.url}')" class="flex-1 bg-blue-50 text-blue-600 hover:bg-blue-100 py-2 px-3 rounded-lg text-sm font-semibold transition-colors flex items-center justify-center gap-2">
                                <i class="fas fa-copy"></i> Copiar Link
                            </button>
                            <button onclick="deleteImage(${img.id})" class="bg-red-50 text-red-500 hover:bg-red-100 p-2 rounded-lg transition-colors">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Drag and drop events
        dropzone.ondragover = (e) => { e.preventDefault(); dropzone.classList.add('border-blue-500', 'bg-blue-50'); };
        dropzone.ondragleave = () => { dropzone.classList.remove('border-blue-500', 'bg-blue-50'); };
        dropzone.ondrop = (e) => {
            e.preventDefault();
            dropzone.classList.remove('border-blue-500', 'bg-blue-50');
            const file = e.dataTransfer.files[0];
            if (file) uploadImage(file);
        };

        init();
    </script>
</body>
</html>
